<h5>Description</h5>

<p>In this stage, we will work on the game logic of our service. Each game party must have the following properties:</p>

<pre><code class="language-java">    gameId = &lt;Long value&gt;  // generated by service

    playerOne = &lt;"username of first player" or ""&gt;  // taken from the access token

    playerTwo = &lt;"username of first player" or ""&gt;  // taken from the access token

    gameStatus = &lt;"created" or "started" or "playing" or "username wins!"&gt;

    playerOneScores = &lt;Integer value, 101 or 301 or 501&gt;  // defined by the game creator

    playerTwoScores = &lt;Integer value, 101 or 301 or 501&gt;  // defined by the game creator

    turn = &lt;"username"&gt;  // indicates the turn </code></pre>

<p>Users should be able to create a game, view the current game status, view games, join a game. At the same time, we need to set the following conditions:</p>

<ul>
    <li>Users should not be able to create a new game if they have an unfinished game on the server;</li>
    <li>Users can join the game that has the <code class="language-java">created</code> status; once two players join the game, it should start. After this, you need to change the <code class="language-java">gameStatus</code> to <code class="language-java">started</code>;</li>
    <li>Two different users must join a game to start it.<span style="color: #66cc66;"> </span>Users can only participate in only one game at a time.</li>
</ul>

<p>For persistence, put the information about games in the database. Our service will include an <strong>H2 database</strong>.</p>

<p><div class="alert alert-warning">To run the tests, the <code class="language-java">application.properties</code> file should contain the following line: <code class="language-java">spring.datasource.url=jdbc:h2:file:../service_db</code>.</div></p>

<h5>Objectives</h5>

<ul>
    <li>Add H2 database dependencies to the project to store the game data;</li>
    <li>Create a database and necessary tables to store the game data;</li>
    <li>Change the <code class="language-java">POST api/game/create</code> endpoint. It must be available to the authorized users and accept data in the JSON format:</li>
</ul>

<pre><code class="language-json">{
  "targetScore": &lt;Integer value&gt;
}</code></pre>

<p>Allowed values are <code class="language-java">101</code>, <code class="language-java">301</code>, <code class="language-java">501</code>. If all the conditions are met, the service must add a new game to the database. The status of the new game must be set to <code class="language-java">created</code> and turned to <code class="language-java">&lt;PlayerName&gt;</code>, where the <code class="language-java">PlayerName</code> is the email of the user who created the game. Endpoint must respond to the following conditions:</p>

<p>In case of success, output the <code class="language-java">HTTP OK</code> status <code class="language-java">200</code> and with the following JSON:</p>

<pre><code class="language-json">{
  "gameId": &lt;Long gameId&gt;,
  "playerOne": "username",
  "playerTwo": "",
  "gameStatus": "created",
  "playerOneScores": targetScore,
  "playerTwoScores": targetScore,
  "turn": "username"
}</code></pre>

<p>If users want to create a game without finishing the previous one, output the <code class="language-java">HTTP BAD REQUEST</code> status <code class="language-java">400</code> and the following JSON:</p>

<pre><code class="language-json">{
  "result": "You have an unfinished game!"
}</code></pre>

<p>If users specify a wrong <code class="language-java">targetScore</code>, output the <code class="language-java">HTTP BAD REQUEST</code> status <code class="language-java">400</code> and the following JSON in the body:</p>

<pre><code class="language-json">{
  "result":  "Wrong target score!"
}</code></pre>

<ul>
    <li>Change the <code class="language-java">GET api/game/status</code> endpoint. It should be available to authorized users only. </li>
</ul>

<p>Let's define the concepts of participation. If a game is found for a user that wants to play, and the status of the game is <code class="language-java">created</code> or <code class="language-java">started</code> or <code class="language-java">playing</code>, then the user automatically participates in the game on the server. In this case, the endpoint must respond with the <code class="language-java">HTTP OK</code> status <code class="language-java">200</code> and the following JSON representing the current state of the game:</p>

<pre><code class="language-java">    {
        "gameId": &lt;Long gameId&gt;,
        "playerOne": &lt;String&gt;,
        "playerTwo": &lt;String&gt;,
        "gameStatus": &lt;String&gt;,
        "playerOneScores": &lt;Integer&gt;,
        "playerTwoScores": &lt;Integer&gt;,
        "turn": &lt;String&gt;
    }</code></pre>

<p>If a user does not participate in a game, the endpoint must respond with the <code class="language-java">HTTP NOT FOUND</code> status <code class="language-java">404</code> and the following JSON:</p>

<pre><code class="language-java">{}</code></pre>

<ul>
    <li>Change the <code class="language-java">GET api/game/list</code> endpoint. it should be available to authorized users only and respond with the <code class="language-java">HTTP OK</code> status <code class="language-java">200</code> and the following JSON that displays all games on the server. Games are ordered by <code class="language-java">gameId</code> in descending order:</li>
</ul>

<pre><code class="language-java">[
    {
        "gameId": &lt;Long gameId&gt;,
        "playerOne": &lt;String&gt;,
        "playerTwo": &lt;String&gt;,
        "gameStatus": &lt;String&gt;,
        "playerOneScores": &lt;Integer&gt;,
        "playerTwoScores": &lt;Integer&gt;,
        "turn": &lt;String&gt;
    },
    {
        "gameId": &lt;Long gameId&gt;,
        "playerOne": &lt;String&gt;,
        "playerTwo": &lt;String&gt;,
        "gameStatus": &lt;String&gt;,
        "playerOneScores": &lt;Integer&gt;,
        "playerTwoScores": &lt;Integer&gt;,
        "turn": &lt;String&gt;
    }
    ...

]</code></pre>

<p>If the server has no current games, the endpoint must respond with the <code class="language-java">HTTP NOT FOUND</code> status <code class="language-java">404</code> and the following JSON:</p>

<pre><code class="language-java">[]</code></pre>

<ul>
    <li>Change the <code class="language-java">GET api/game/join/{game Id}</code> endpoint. It must be available to the authorized users and respond with the <code class="language-java">HTTP OK</code> status <code class="language-java">200</code> and the JSON below (the user's joined the game; game status is <code class="language-java">created</code>; the user is not involved in other games):</li>
</ul>

<pre><code class="language-java">    {
        "gameId": &lt;Long gameId&gt;,
        "playerOne": &lt;String&gt;,
        "playerTwo": &lt;String&gt;,
        "gameStatus": "started",
        "playerOneScores": &lt;Integer&gt;,
        "playerTwoScores": &lt;Integer&gt;,
        "turn": &lt;playerOne&gt;
    }</code></pre>

<p>After this, change the game status from <code class="language-java">created</code> to <code class="language-java">started</code>. If a game with the specified <code class="language-java">id</code> is not found, the endpoint responds with the <code class="language-java">HTTP NOT FOUND</code> status <code class="language-java">404</code> and the following JSON:</p>

<pre><code class="language-json">{
  "result": "Game not found!"
}</code></pre>

<p>If a player tries to join the game they created, the endpoint must respond with the <code class="language-java">HTTP BAD REQUEST</code> status <code class="language-java">400</code> and the following JSON:</p>

<pre><code class="language-json">{
  "result": "You can't play alone!"
}</code></pre>

<p>If the game status is not available for joining (the status is not <code class="language-java">created</code>), the endpoint must respond with the <code class="language-java">HTTP BAD REQUEST</code> status <code class="language-java">400</code> and the following JSON:</p>

<pre><code class="language-json">{
  "result": "You can't join the game!"
}</code></pre>

<p>If a user is involved in another game on a server, the endpoint must respond with the <code class="language-java">HTTP BAD REQUEST</code> status <code class="language-java">400</code> and the following JSON:</p>

<pre><code class="language-json">{
  "result": "You have an unfinished game!"
}</code></pre>

<h5>Examples</h5>

<p><strong>Example 1: </strong><em>a POST request for /api/game/create with the correct access token; the user is not involved in other games</em></p>

<pre><code class="language-json">{
  "targetScore": 501
}</code></pre>

<p><em>Response: </em><code class="language-java">200 OK</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
    "gameId": 1,
    "playerOne": "PlayerOne@acme.com",
    "playerTwo": "",
    "gameStatus": "created",
    "playerOneScores": 501,
    "playerTwoScores": 501,
    "turn": "PlayerOne@acme.com"
}</code></pre>

<p><strong>Example 2: </strong><em>a POST request for /api/game/create with the correct access token; the user is involved in an unfinished game on the server</em></p>

<pre><code class="language-json">{
  "targetScore": 501
}</code></pre>

<p><em>Response: </em><code class="language-java">400 BAD REQUEST</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
  "result": "You can't join the game!"
}</code></pre>

<p><br>
    <strong>Example 3: </strong><em>a POST request for /api/game/create with the correct access token and the body</em></p>

<pre><code class="language-json">{
  "targetScore": 801
}</code></pre>

<p><em>Response: </em><code class="language-java">400 BAD REQUEST</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
  "result": "Wrong target score!"
}</code></pre>

<p><strong>Example 4:</strong> <em>a GET request for /api/game/status with the correct access token</em></p>

<p><em>Response: </em><code class="language-java">200 OK</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
    "gameId": 1,
    "playerOne": "PlayerOne@acme.com",
    "playerTwo": "",
    "gameStatus": "created",
    "playerOneScores": 501,
    "playerTwoScores": 501,
    "turn": "PlayerOne@acme.com"
}</code></pre>

<p><strong>Example 5:</strong> <em>a GET request for /api/game/list with the correct access token</em></p>

<p><em>Response: </em><code class="language-java">200 OK</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-java">[
    {
        "gameId": 5,
        "playerOne": "PlayerZ@acme.com",
        "playerTwo": "",
        "gameStatus": "created",
        "playerOneScores": 501,
        "playerTwoScores": 501,
        "turn": "PlayerZ@acme.com"
    },
   ...
    {
        "gameId": 1,
        "playerOne": "PlayerX@acme.com",
        "playerTwo": "PlayerY@acme.com",
        "gameStatus": "started",
        "playerOneScores": 101,
        "playerTwoScores": 101,
        "turn": "PlayerX@acme.com"
    }
]</code></pre>

<p><strong>Example 6:</strong> <em>a GET request for /api/game/join/1 with the correct access token; the game status is created, and the user does not participate in other games</em></p>

<p><em>Response: </em><code class="language-java">200 OK</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-java">{
    "gameId": 1,
    "playerOne": "PlayerX@acme.com",
    "playerTwo": "PlayerY@acme.com",
    "gameStatus": "started",
    "playerOneScores": 501,
    "playerTwoScores": 501,
    "turn": "PlayerX@acme.com"
}</code></pre>

<p><strong>Example 7:</strong> a <code class="language-java">GET</code> request for<em> </em><code class="language-java">/api/game/join/1</code> with a correct access token and If the user is involved in another game on a server:</p>

<p><em>Response: </em><code class="language-java">400 BAD REQUEST</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
  "result": "You have an unfinished game!"
}</code></pre>

<p><br>
    <strong>Example 8:</strong> <em>a GET request for /api/game/join/1 with the correct access token; the game status is not created</em></p>

<p><em>Response: </em><code class="language-java">400 BAD REQUEST</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
  "result": "You can't join the game!"
}</code></pre>

<p><strong>Example 9:</strong> <em>a GET request for /api/game/join/1 with the correct access token, but the game is not found on the server</em></p>

<p><em>Response: </em><code class="language-java">404 NOT FOUND</code></p>

<p><em>Response body:</em></p>

<pre><code class="language-json">{
  "result": "Game not found!"
}</code></pre>